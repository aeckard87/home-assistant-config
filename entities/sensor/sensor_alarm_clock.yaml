###################################################################################################
## Template Sensors
###################################################################################################
  - platform: template
    sensors:

###################################################################################################
## Auto Alarm Clock Status
## - sensor to show alarm status in glance alerts, alarm settings popup
###################################################################################################
      alarm_clock_status_auto:
        friendly_name: Alarm
        icon_template: >-
          {% if is_state('sensor.alarm_clock_status_auto','Snooze')  %} mdi:alarm-snooze
          {% elif is_state('sensor.alarm_clock_status_auto','Active') %} mdi:alarm-multiple
          {% elif is_state('sensor.alarm_clock_status_auto','Set') %} mdi:alarm-check
          {% else %} mdi:alarm-off
          {% endif %}
        value_template: >-
          {% if is_state('input_boolean.alarm_clock_active_auto','on') and is_state('input_boolean.alarm_clock_snooze','on') %} Snooze
          {% elif is_state('input_boolean.alarm_clock_active_auto','on') %} Active
          {% elif is_state('input_boolean.alarm_clock_auto','on') %}
            {% if states('sensor.time') < '12:00' and is_state('binary_sensor.work_today', 'on') %} Set
            {% elif states('sensor.time') > '12:00' and is_state('binary_sensor.work_tomorrow', 'on') %} Set
            {% elif is_state('input_boolean.alarm_clock_auto_weekends', 'on')
               and (( states('sensor.time') > '12:00'
                  and now().weekday() == 4 )
               or ( now().weekday() == 5
               or now().weekday() == 6
               or ( states('sensor.time') > '12:00'
                  and is_state('binary_sensor.holiday_tomorrow','on') ) )
               or is_state('input_boolean.work_schedule','off') ) %} Set
            {% else %} Off
            {% endif %}
          {% else %} Off
          {% endif %}

###################################################################################################
## Manual Alarm Clock Status
## - sensor to show alarm status in glance alerts, alarm settings popup
###################################################################################################
      alarm_clock_status_manual:
        friendly_name: Manual Alarm
        icon_template: >-
          {% if is_state('sensor.alarm_clock_status_manual','Snooze') %} mdi:alarm-snooze
          {% elif is_state('sensor.alarm_clock_status_manual','Active') %} mdi:alarm-multiple
          {% elif is_state('sensor.alarm_clock_status_manual','Set') %} mdi:alarm-check
          {% else %} mdi:alarm-off
          {% endif %}
        value_template: >-
          {% if is_state('input_boolean.alarm_clock_active_manual','on') and is_state('input_boolean.alarm_clock_snooze','on') %} Snooze
          {% elif is_state('input_boolean.alarm_clock_active_manual','on') %} Active
          {% elif is_state('input_boolean.alarm_clock_manual','on') %} Set
          {% else %} Off
          {% endif %}

###################################################################################################
## Nap Alarm Clock Status
## - sensor to show alarm status in glance alerts, alarm settings popup
###################################################################################################
      alarm_clock_status_nap:
        friendly_name: Nap Alarm
        icon_template: >-
          {% if is_state('sensor.alarm_clock_status_nap','Snooze') %} mdi:alarm-snooze
          {% elif is_state('sensor.alarm_clock_status_nap','Active') %} mdi:alarm-multiple
          {% elif is_state('sensor.alarm_clock_status_nap','Set') %} mdi:alarm-check
          {% else %} mdi:alarm-off
          {% endif %}
        value_template: >-
          {% if is_state('input_boolean.alarm_clock_active_nap','on') and is_state('input_boolean.alarm_clock_snooze','on') %} Snooze
          {% elif is_state('input_boolean.alarm_clock_active_nap','on') %} Active
          {% elif is_state('input_boolean.alarm_clock_nap','on') %} Set
          {% else %} Off
          {% endif %}

##################################################################################################
# Alarm Clock Media Player
##################################################################################################
      alarm_clock_media_player:
        friendly_name: Alarm Clock Media Player
        icon_template: mdi:animation-play
        entity_id: input_select.alarm_clock_media_player
        value_template:  >-
            {% set entities = state_attr('group.all_media_players', 'entity_id') %}
            {% set mplayer =  states.media_player | selectattr('entity_id', 'in', entities)
                                  | selectattr( 'name','eq',states('input_select.alarm_clock_media_player'))
                                  | map(attribute='entity_id')
                                  | join(',') %}
            {% if not mplayer == '' %}
              {{ mplayer }}
            {% else %}
              unavailable
            {% endif %}

##################################################################################################
# Alarm Clock Media Player State
##################################################################################################
      alarm_clock_media_player_state:
        friendly_name: Alarm Clock Media Player State
        icon_template: mdi:animation-play
        value_template: "{{ states(states('sensor.alarm_clock_media_player')) }}"

